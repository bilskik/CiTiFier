<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:hx-on="http://www.w3.org/1999/xhtml">
<head th:replace="~{fragments/head :: head}">
    <title>Challenge</title>
</head>
<script type="text/javascript" src="/js/challenge/challenge.js" defer></script>
<body>
    <th:block th:insert="~{common/navbar.html}">
    </th:block>
    <form
        th:hx-post="@{/ctf-creator/challenge}"
        th:hx-trigger="submit"
        th:hx-include=".challenge"
        th:hx-target="body"
        th:hx-swap="outerHTML"
        th:hx-push-url="false"
        id="challenge-form"
        class="container-fluid ps-5 pe-5 w-100 h-100"
        th:object="${challengeDTO}"
    >
        <div class="row g-5">
            <div class="challenge-left col-sm">
                <div class="form-group">
                    <label
                            th:text="#{ctfcreator.challenge.name}"
                            for="challenge-name"
                            class="form-label"
                    ></label>
                    <input
                            id="challenge-name"
                            th:field="*{name}"
                            type="text"
                            class="challenge form-control"
                            th:classappend="${#fields.hasErrors('name') ? 'is-invalid' : ''}"
                            th:title="#{ctfcreator.challenge.error-name}"
                            pattern="^[a-zA-Z0-9]{4,50}$"
                            required
                    />
                    <p
                            th:if="${#fields.hasErrors('name')}"
                            th:errors="*{name}"
                            class="invalid-feedback"
                    ></p>
                </div>
            </div>
                <div class="form-group">
                    <label
                            th:text="#{ctfcreator.challenge.github-link}"
                            for="github-link"
                            class="form-label"
                    ></label>
                    <input
                            id="github-link"
                            th:field="*{githubLink}"
                            type="text"
                            class="challenge githubLink form-control"
                            pattern="https:\/\/github\.com\/([^\/]+)\/([^\/]+)"
                            required
                    >
                    <input id="private-github-clone-info" type="hidden" th:data-state="${githubLinkState}" th:data-info="${githubLinkInfo}" />
                    <p
                            id="htmx-github-link-error"
                    ></p>
                    <label
                            th:text="#{ctfcreator.challenge.is-github-repo-visibility}"
                            for="github-repo-visibility"
                            class="form-check-label"
                    >
                    </label>
                    <input
                            th:hx-post="@{/ctf-creator/challenge/github-repo-visibility}"
                            th:hx-trigger="change"
                            hx-target="#challenge-github-button"
                            hx-include=".githubLink"
                            th:hx-swap="innerHTML"
                            th:hx-push-url="false"
                            th:disabled="*{isRepoClonedSuccessfully}"
                            id="github-repo-visibility"
                            name="githubRepoPrivateVisibility"
                            type="checkbox"
                            class="form-check-input githubLink"
                    />
                    <div id="challenge-github-button" hx-on::after-swap="handleAfterSwap(event);">
                       <th:block th:insert="~{ctfcreator/challenge/github/github-public-repo-button.html}">
                        </th:block>
                    </div>
                    <button
                        id="challenge-save-in-session"
                        th:hx-post="@{/ctf-creator/challenge/save-in-session}"
                        th:hx-trigger="click"
                        th:hx-include=".challenge"
                        class="invisible"
                    >
                    </button>
                </div>
                <div class="form-group">
                    <label
                            th:text="#{ctfcreator.challenge.number-of-app}"
                            for="github-link"
                            class="form-label"
                    ></label>
                    <input
                            id="number-of-app"
                            th:field="*{numberOfApp}"
                            th:classappend="${#fields.hasErrors('numberOfApp') ? 'is-invalid' : ''}"
                            type="text"
                            class="challenge numberOfApp form-control"
                            required
                    >
                </div>
                <div class="form-group">
                    <label
                            th:text="#{ctfcreator.challenge.start-exposed-port}"
                            for="start-exposed-port"
                            class="form-label"
                    ></label>
                    <input
                            id="start-exposed-port"
                            th:field="*{startExposedPort}"
                            th:classappend="${#fields.hasErrors('startExposedPort') ? 'is-invalid' : ''}"
                            type="text"
                            class="challenge startExposedPort form-control"
                            required
                    >
                </div>
            </div>
            <div class="challenge-right col-sm">
                <div class="form-group">
                    <label
                            th:text="#{ctfcreator.challenge.flag-generation-method}"
                            for="flag-generation-method"
                    ></label>
                    <select
                            id="flag-generation-method"
                            th:field="*{flagGenerationMethod}"
                            class="challenge form-control"
                            required
                    >

                        <option th:each="method: ${flagGenerationMethods}" th:text="${method}" th:value="${method}"></option>
                    </select>
                </div>
                </div>
            </div>
        </div>
        <button
                th:text="#{common.create}"
                type="submit"
                class="btn btn-primary border float-end"
        >
        </button>
    </form>
</body>
</html>